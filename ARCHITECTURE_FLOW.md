# EfficientSAM3 æ•°æ®æµç¨‹æ¶æ„å›¾

## ä¸¤æ¡æ¨ç†è·¯å¾„å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EfficientSAM3 æ¶æ„                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥å›¾åƒ [1, 3, 1024, 1024]
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Image Encoder     â”‚  âœ… ONNX (22MB)
    â”‚  (RepViT-M0.9)     â”‚  æ¥æº: detector.backbone.vision_backbone
    â”‚  4.72M params      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ image_embeddings [1, 256, 64, 64]
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                          â”‚
    â–¼                                                          â–¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  è·¯å¾„ 1: ç‚¹æç¤ºåˆ†å‰² (Tracker)          è·¯å¾„ 2: æ–‡æœ¬æ¦‚å¿µåˆ†å‰² (Detector)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç‚¹å‡»åæ ‡ [[x, y]]                        æ–‡æœ¬ "a dog"
    â”‚                                         â”‚
    â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prompt Encoder     â”‚ âœ… ONNX (63KB)   â”‚  Tokenizer         â”‚ âš ï¸ å¤–éƒ¨
â”‚ (SAM Prompt)       â”‚                  â”‚  (SimpleTokenizer) â”‚
â”‚ 0.01M params       â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
         â”‚                                         â”‚ input_ids [1, 32]
         â”‚ sparse_emb [1, N+1, 256]               â”‚
         â”‚ dense_emb [1, 256, 64, 64]             â–¼
         â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                              â”‚ Text Encoder       â”‚ âœ… ONNX (242MB)
         â”‚                              â”‚ (MobileCLIP-S1)    â”‚
         â”‚                              â”‚ 63.56M params      â”‚
         â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                        â”‚
         â”‚                                        â”‚ text_features [1, 32, 256]
         â”‚                                        â”‚
         â–¼                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ Transformer Fusion â”‚ âš ï¸ ä»…æƒé‡ (80MB)
â”‚  Mask Decoder      â”‚ âœ… ONNX (16MB)  â”‚ (6å±‚è·¨æ¨¡æ€æ³¨æ„åŠ›)   â”‚ éœ€è¦ PyTorch
â”‚  (SAM Decoder)     â”‚                 â”‚ 21.05M params      â”‚
â”‚  4.06M params      â”‚                 â”‚                    â”‚
â”‚                    â”‚                 â”‚ â€¢ Self-Attention   â”‚
â”‚ â€¢ 2å±‚Transformer   â”‚                 â”‚ â€¢ Cross-Attention  â”‚
â”‚ â€¢ Cross-Attn       â”‚                 â”‚   (text â†” vision)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                        â”‚
         â”‚                                        â”‚ fused [1, 256, 64, 64]
         â”‚                                        â”‚
         â–¼                                        â–¼
masks [1, 3, 256, 256]               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
iou [1, 3]                           â”‚ Segmentation Head  â”‚ âš ï¸ ONNX (6.8MB)
         â”‚                           â”‚ 2.30M params       â”‚ æƒé‡éƒ¨åˆ†åŒ¹é…
         â”‚                           â”‚                    â”‚
         â”‚                           â”‚ â€¢ Pixel Decoder    â”‚
         â”‚                           â”‚ â€¢ Cross-Attn+Text  â”‚
         â–¼                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é€‰æœ€ä½³: masks[argmax(iou)]                     â”‚
         â”‚                                     â”‚ masks [1, N, 64, 64]
         â”‚                                     â”‚ hidden_states [1, N, 256]
         â”‚                                     â”‚
         â–¼                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
æœ€ç»ˆåˆ†å‰² mask                         â”‚ Scoring Module     â”‚ âš ï¸ ONNX (4.6MB)
[256, 256]                           â”‚ 1.18M params       â”‚ æƒé‡éƒ¨åˆ†åŒ¹é…
                                     â”‚                    â”‚
                                     â”‚ â€¢ è¯„ä¼°ç½®ä¿¡åº¦        â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ scores [1, N]
                                               â”‚
                                               â–¼
                                      è¿‡æ»¤+é€‰æ‹©æœ€ä½³ masks
                                      [1, K, 64, 64]
                                               â”‚
                                               â–¼
                                      ä¸Šé‡‡æ ·åˆ°åŸå§‹åˆ†è¾¨ç‡
```

## å‚æ•°åˆ†å¸ƒ

```
Detector (98%, 573.93M params)          Tracker (2%, 11.74M params)
â”œâ”€ Image Encoder: 4.72M                 â”œâ”€ Prompt Encoder: 0.01M  âœ…
â”œâ”€ Text Encoder: 63.56M                 â”œâ”€ Mask Decoder: 4.06M    âœ…
â”œâ”€ Transformer Fusion: 21.05M âš ï¸        â””â”€ Memory/Temporal: 7.67M (è§†é¢‘)
â”œâ”€ Segmentation Head: 2.30M  âš ï¸
â”œâ”€ Scoring Module: 1.18M     âš ï¸
â””â”€ Geometry Encoder: 8.22M (æœªå¯¼å‡º)
```

## æ¨ç†èƒ½åŠ›å¯¹æ¯”

| è·¯å¾„ | è¾“å…¥ | è¾“å‡º | ONNXæ”¯æŒ | ç”¨é€” |
|-----|------|------|---------|------|
| **è·¯å¾„1** | å›¾åƒ + ç‚¹åæ ‡ | å•ä¸ªmask | âœ… 100% | äº¤äº’å¼æ ‡æ³¨ |
| **è·¯å¾„2** | å›¾åƒ + æ–‡æœ¬ | å¤šä¸ªmasks | âš ï¸ ~60% | è‡ªåŠ¨æ£€æµ‹ |

## ç¬¦å·è¯´æ˜

- âœ… å¯ç”¨ONNX - å·²å¯¼å‡ºï¼Œå¯ç›´æ¥ä½¿ç”¨
- âš ï¸ éœ€PyTorch - å·²å¯¼å‡ºä½†æƒé‡ä¸å®Œå…¨åŒ¹é…ï¼Œæˆ–ä»…æœ‰æƒé‡æ–‡ä»¶
- ğŸ“¦ æ¥æºcheckpoint - ä»PTHæ–‡ä»¶æå–çš„è·¯å¾„

## æ¨èéƒ¨ç½²æ–¹æ¡ˆ

**ç‚¹æç¤ºåˆ†å‰²**: çº¯ONNX âœ…
```python
onnx_image_encoder + onnx_prompt_encoder + onnx_mask_decoder
```

**æ–‡æœ¬æ¦‚å¿µåˆ†å‰²**: å®Œå…¨PyTorch æ¨è âœ…
```python
from sam3.model_builder import build_efficientsam3_image_model
model = build_efficientsam3_image_model(checkpoint_path)
```
