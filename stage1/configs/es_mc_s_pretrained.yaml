# MobileCLIP-S0 Pretrained Weights Configuration
# Use this config to initialize from pretrained MobileCLIP-S0 instead of random init

MODEL:
  NAME: EfficientSAM3_Text_S_Pretrained
  BACKBONE: MobileCLIP-S0
  # Download pretrained weights:
  # mkdir -p checkpoints/mobileclip
  # wget https://docs-assets.developer.apple.com/ml-research/datasets/mobileclip/mobileclip_s0.pt -P checkpoints/mobileclip
  PRETRAINED: 'checkpoints/mobileclip/mobileclip_s0.pt'
  RESUME: ''

TRAIN:
  START_EPOCH: 0
  EPOCHS: 100  # Increased from 50
  WARMUP_EPOCHS: 10  # Increased from 5
  WEIGHT_DECAY: 0.05  # Increased from 0.01
  BASE_LR: 5e-3  # Increased from 1e-3
  WARMUP_LR: 1e-6
  MIN_LR: 5e-6  # Increased from 1e-5
  CLIP_GRAD: 1.0  # Reduced from 5.0
  AUTO_RESUME: True
  ACCUMULATION_STEPS: 2  # Increased from 1
  USE_CHECKPOINT: False
  LAYER_LR_DECAY: 0.9  # Reduced from 1.0
  EVAL_BN_WHEN_TRAINING: False
  FIND_UNUSED_PARAMETERS: True

  LR_SCHEDULER:
    NAME: 'cosine'
    DECAY_EPOCHS: 30
    DECAY_RATE: 0.1

  OPTIMIZER:
    NAME: 'adamw'
    EPS: 1e-8
    BETAS: (0.9, 0.999)
    MOMENTUM: 0.9

AMP_ENABLE: True
OUTPUT: output/stage1_text/mobileclip_s0_pretrained
TAG: pretrained_init
SAVE_FREQ: 1
PRINT_FREQ: 10
SEED: 0
EVAL_MODE: False
THROUGHPUT_MODE: False
LOCAL_RANK: 0

DATA:
  IMG_SIZE: 1008
  DATASET: recap_datacomp
  DATA_PATH: data/
  BATCH_SIZE: 64
  NUM_WORKERS: 8

DISTILL:
  ENABLED: True
  ENCODER_ONLY: True
  EMBED_DIM: 256
  EMBED_SIZE: 0
  NUM_EMBED: 32
  PIXEL_WISE: 1.0
  CHANNEL_WISE: 0.0
  CORRELATION: 0.0
  COSINE: 2.0  # Increased from 1.0
  TEACHER_EMBED_PATH: 'output/stage1_text_teacher/embeddings'
  SAVE_TEACHER_EMBED: False
  NO_RAND: True
  MAX_ALLOWED_PROMPTS: -1
